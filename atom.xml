<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Sany&#39;s Blog</title>
  
  <subtitle>Getting Better Each Day!!!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://san-y.github.io/"/>
  <updated>2018-09-21T09:54:23.976Z</updated>
  <id>http://san-y.github.io/</id>
  
  <author>
    <name>Sany</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>testFile</title>
    <link href="http://san-y.github.io/testFile/"/>
    <id>http://san-y.github.io/testFile/</id>
    <published>2018-09-21T09:11:04.000Z</published>
    <updated>2018-09-21T09:54:23.976Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-引用块"><a href="#1-引用块" class="headerlink" title="1.引用块"></a>1.引用块</h2><ul><li><p>样例</p><ul><li><p>没有提供参数，则只输出普通的 blockquote</p><blockquote><p>content</p><footer><strong>[author[</strong><cite>source]] [link] [source_link_title]</cite></footer></blockquote></li><li><p>引用书上的句子</p><blockquote><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque hendrerit lacus ut purus iaculis feugiat. Sed nec tempor elit, quis aliquam neque. Curabitur sed diam eget dolor fermentum semper at eu lorem.</p></blockquote></li><li><p>引用 Twitter</p><blockquote><p>NEW: DevDocs now comes with syntax highlighting. <a href="http://devdocs.io" target="_blank" rel="noopener">http://devdocs.io</a></p><footer><strong>@DevDocs</strong><cite><a href="https://twitter.com/devdocs/status/356095192085962752" target="_blank" rel="noopener">twitter.com/devdocs/status/356095192085962752</a></cite></footer></blockquote></li><li><p>引用网络上的文章</p><blockquote><p>Every interaction is both precious and an opportunity to delight.</p><footer><strong>Seth Godin</strong><cite><a href="http://sethgodin.typepad.com/seths_blog/2009/07/welcome-to-island-marketing.html" target="_blank" rel="noopener">Welcome to Island Marketing</a></cite></footer></blockquote></li></ul></li><li><p>代码块</p><ul><li><p>在文章中插入代码。</p><p><strong>别名：</strong> :code</p><figure class="highlight plain"><figcaption><span>[title] [] [url] [link text]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code snippet</span><br></pre></td></tr></table></figure></li><li><p>样例</p></li><li><p>普通的代码块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(&apos;Hello World!&apos;);</span><br></pre></td></tr></table></figure></li><li><p>指定语言</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[rectangle setX: <span class="number">10</span> y: <span class="number">10</span> width: <span class="number">20</span> height: <span class="number">20</span>];</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String:args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"abc"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>附加说明</p><figure class="highlight plain"><figcaption><span>Array.map</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.map(callback[, thisArg])</span><br></pre></td></tr></table></figure></li><li><p>附加说明和网址</p><figure class="highlight plain"><figcaption><span>_.compact</span><a href="http://underscorejs.org/#compact" target="_blank" rel="noopener">Underscore.js</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_.compact([0, 1, false, 2, &apos;&apos;, 3]);</span><br><span class="line">=&gt; [1, 2, 3]</span><br></pre></td></tr></table></figure></li></ul></li><li><p>反引号代码块</p><p>  另一种形式的代码块，不同的是它使用三个反引号来包裹。</p><pre><code>class test {             public static void main(String:args) {                 System.out.println(&quot;abc&quot;);                 }             }</code></pre></li></ul><ul><li><p>Youtube<br>在文章中插入 Youtube 视频。</p><div class="video-container"><iframe src="//www.youtube.com/embed/PPMvvUEenUU" frameborder="0" allowfullscreen></iframe></div></li><li><p>Image<br>  在文章中插入指定大小的图片。</p>  <img class="[class names] images/head.jpg [width] [height] [title text [alt text]]"></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-引用块&quot;&gt;&lt;a href=&quot;#1-引用块&quot; class=&quot;headerlink&quot; title=&quot;1.引用块&quot;&gt;&lt;/a&gt;1.引用块&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;样例&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;没有提供参数，则只输出普通的 blockquote&lt;/p&gt;

      
    
    </summary>
    
      <category term="life" scheme="http://san-y.github.io/categories/life/"/>
    
      <category term="test" scheme="http://san-y.github.io/categories/life/test/"/>
    
    
      <category term="test" scheme="http://san-y.github.io/tags/test/"/>
    
      <category term="file" scheme="http://san-y.github.io/tags/file/"/>
    
  </entry>
  
  <entry>
    <title>FileName</title>
    <link href="http://san-y.github.io/FileName/"/>
    <id>http://san-y.github.io/FileName/</id>
    <published>2018-09-19T09:48:32.000Z</published>
    <updated>2018-10-08T08:04:01.778Z</updated>
    
    <content type="html"><![CDATA[<h1 id="如何升级Cloudera-Manager和CDH"><a href="#如何升级Cloudera-Manager和CDH" class="headerlink" title="如何升级Cloudera Manager和CDH"></a>如何升级Cloudera Manager和CDH</h1><p>标签（空格分隔）： 未分类</p><hr><p>##1.Cloudera升级概述##<br>    下面描述的流程适用于由Cloudera Manager管理的集群，对于不是由Cloudera Manager管理的集群升级，请参考：<a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_ig_upgrade_command_line.html#xd_583c10bfdbd326ba--5a52cca-1476e7473cd--7f99" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_ig_upgrade_command_line.html#xd_583c10bfdbd326ba--5a52cca-1476e7473cd--7f99</a></p><pre><code>你可以使用tarballs或operating system packages来升级Cloudera Manager，然后使用packages或parcels来升级CDH。同时有可能还需要安装一个新版JDK。升级Cloudera Manager的同时Cloudera Navigator也会被升级。CDH和Cloudera Manager不用同时升级，但是需要保证Cloudera Manager和CDH版本的兼容。Cloudera Manager可以管理当前或以前的major版本的CDH，或相同minor版本的CDH，或较低minor版本的CDH。比如，Cloudear Manager 5.7.1可以管理CDH5.7.2，CDH5.6.1和CDH4.8.6，但是不能管理CDH5.8.1. Cloudera Manager5.x不能管理CDH3.x。升级时具体有如下几种选择：![此处输入图片的描述][1]  [1]: https://mmbiz.qpic.cn/mmbiz_png/THumz4762QDbM3QAly6pQeCToAHTmYVOiaH38U2NqfeV7icJW5U4D36DKf6Vzwfdia4RMclWiczuhIQuV5LT5qGCKw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1</code></pre><ol><li><p>评估升级影响</p><p> 一般需要规划一个足够长的维护窗口(停机时间)进行升级。根据需要升级的组件，集群的节点数，以及不同的硬件情况，你可能需要一整天来进行升级。开始升级之前，你需要做好一些前置条件准备以及关键数据备份，这篇文档在讲述升级步骤时也会说明。<br>升级之前，需要查阅Cloudera Manager的<a href="https://www.cloudera.com/documentation/enterprise/release-notes/topics/rg_release_notes.html，了解API更改，不推荐的功能，新的功能以及不兼容的更改。同时需要检查https://www.cloudera.com/documentation/enterprise/release-notes/topics/rn_consolidated_pcm.html来确认支持的操作系统，JDK，数据库和其他组件。" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/release-notes/topics/rg_release_notes.html，了解API更改，不推荐的功能，新的功能以及不兼容的更改。同时需要检查https://www.cloudera.com/documentation/enterprise/release-notes/topics/rn_consolidated_pcm.html来确认支持的操作系统，JDK，数据库和其他组件。</a><br><strong>一共有三种版本的升级：major，minor和maintenance。</strong> <strong>Major升级</strong><br>Major版本的升级通常有以下特征：<br>Hadoop的大版本变化，涉及很多更新内容</p><ul><li>不兼容的数据格式</li><li>Cloudera Manager界面的重大变化</li><li>Cloudera Manager的数据库schema变动，不过可以在升级过程中自动被处理</li><li>需要较长的停机时间</li><li>需要重新部署客户端<br> 你也可以只升级major版本，而保持minor版本不变，比如你可以从4.8.1升级到5.8.0.为了方便下一个major版本的升级(CDH6)，我们建议您现在可以将集群升级到5.x<br><strong>Minor版本升级</strong><br>Minor版本升级是指基于同样的major版本将minor版本进行升级，比如从5.4.x升级到5.8.x，一般有以下特征：</li><li>新的功能</li><li>Bug修复</li><li>可能存在的数据库schema更改会在Cloudera Manager升级时自动被处理<br>一般来说，minor版本的升级不包括不兼容的更改或者数据格式的变化。客户端配置(<a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cm_mc_client_config.html#cmug_topic_5_9)会被重置。" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/latest/topics/cm_mc_client_config.html#cmug_topic_5_9)会被重置。</a><br><strong>Maintenance版本升级</strong><br>Maintenance版本升级主要是重大bug修复或者解决一些安全问题。不会有兼容性修改和新功能。</li></ul></li><li><p>Cloudera Manager升级概述<br><img src="https://mmbiz.qpic.cn/mmbiz_png/THumz4762QDbM3QAly6pQeCToAHTmYVObkI6NMcT4AlibN5ksYylvBLSgwl4HHDVYv0jTgEXItdGdelAFQLL3QQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="此处输入图片的描述"></p></li></ol><p>  升级Cloudera Manager包括以下步骤：<br>1.在CM节点上升级Cloudera Manager Server，使用操作系统的命令，比如Redhat的yum。也可以手动通过tarballs来升级。tarballs升级比较适合集群中已经有一些可以同时操作多台机器的脚本，程序或工具。<br>2.在所有主机上升级Cloudera Manager agent，Cloudera Manager的升级向导可以帮助你升级agent(JDK升级可选)，同时也可以手动的通过tarballs升级JDK和agent。在这个过程中，CDH并不会被升级。<br>Cloudera Manager升级，可以参考官网文档：<a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cm_upgrade.html#concept_q1q_mbs_wx" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/latest/topics/cm_upgrade.html#concept_q1q_mbs_wx</a></p><ol start="3"><li><p>CDH升级概述<br><img src="https://mmbiz.qpic.cn/mmbiz_png/THumz4762QDbM3QAly6pQeCToAHTmYVORdFNcVFryBV7IGQOGhOANNp9ibCdbNPEwq5FvTsRPvmfIWCY4VTicbibA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="此处输入图片的描述"><br>CDH升级包含Hadoop相关组件的升级，你可以使用Cloudera Manager来升级CDH，采用parcel或package的方式都可以。<br><strong>3.1使用Parcel升级(同时适用于滚动升级)</strong><br>我们建议使用parcels来升级CDH，因为Cloudera Manager管理这些parcels自动下载，分发和激活。有两种方式的升级：<br>Parcels:需要重启集群才能完成升级。<br>滚动升级：如果HDFS启用了高可用HA，可以在不重启集群的情况下进行滚动升级。为了简化升级步骤，可以考虑从package切换到parcels，这样Cloudera Manager可以大大简化升级步骤。在升级CDH5的时候你从package切换到parcels也可以。<br><strong>3.2使用Packages升级</strong><br>使用packages升级需要你提前下载好需要升级的packages，然后手动的运行package更新命令来升级，注意所有主机都需要进行相同的操作。<br>从Cloudera Manager5.3开始，CDH提供向导式的升级包括major版本升级(CDH5到CDH5)，minor版本升级(CDH5.x到5.y)和maintenance版本升级(CDHa.b.x到CDHa.b.y)。无论你是使用parcels安装还是package都支持，但是package需要你手动安装和升级，但是parcels可以被Cloudera Manager自动安装和升级。</p></li><li><p>Cloudera Navigator升级概述<br>当升级Cloudera Manager的时候，Cloudera Navigator Metadata和Audit servers会被自动升级。你还可以升级其他的Navigator组件比如Cloudera Navigator Key Trustee Server, Cloudera Navigator Key HSM和Cloudera Navigator Encrypt。当然也可以选择不升级。</p></li><li><p>JDK升级<br>在升级Cloudera Manager和CDH之前，请确保集群内的所有主机都是使用受支持的Oracle JDK，参考：<a href="https://www.cloudera.com/documentation/enterprise/release-notes/topics/rn_consolidated_pcm.html。同时，所有主机必须使用相同版本的JDK：参考：https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_cm_upgrading_to_jdk8.html#xd_583c10bfdbd326ba-590cb1d1-149e9ca9886--7c46" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/release-notes/topics/rn_consolidated_pcm.html。同时，所有主机必须使用相同版本的JDK：参考：https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_cm_upgrading_to_jdk8.html#xd_583c10bfdbd326ba-590cb1d1-149e9ca9886--7c46</a></p></li></ol><h2 id="2-Minor版本升级"><a href="#2-Minor版本升级" class="headerlink" title="2.Minor版本升级"></a>2.Minor版本升级</h2><pre><code>升级前置条件：1.确保当前系统版本支持您要升级到的新版本CDH5和Cloudera Manager52.原Cloudera Manager和CDH的版本为5.4.33.Cloudera Manager和CDH的目标升级版本为5.11.1</code></pre><ol><li>Cloudera Manager升级<br><strong>1.1升级前准备<br>1.1.1Cloudera Manager的yum源配置</strong><br>1.准备待升级rpm包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5.11.1/RPMS/x86_64/cloudera-manager-agent-5.11.1-1.cm5111.p0.9.el6.x86_64.rpm</span><br><span class="line">wget http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5.11.1/RPMS/x86_64/cloudera-manager-daemons-5.11.1-1.cm5111.p0.9.el6.x86_64.rpm</span><br><span class="line">wget http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5.11.1/RPMS/x86_64/cloudera-manager-server-5.11.1-1.cm5111.p0.9.el6.x86_64.rpm</span><br><span class="line">wget http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5.11.1/RPMS/x86_64/cloudera-manager-server-db-2-5.11.1-1.cm5111.p0.9.el6.x86_64.rpm</span><br><span class="line">wget http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5.11.1/RPMS/x86_64/enterprise-debuginfo-5.11.1-1.cm5111.p0.9.el6.x86_64.rpm</span><br><span class="line">wget http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5.11.1/RPMS/x86_64/jdk-6u31-linux-amd64.rpm</span><br><span class="line">wget http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5.11.1/RPMS/x86_64/oracle-j2sdk1.7-1.7.0+update67-1.x86_64.rpm</span><br></pre></td></tr></table></figure></li></ol><pre><code>2.将下载的安装包放在/var/www/html/cm5.11.1目录下![此处输入图片的描述][4] 进入cm5.11.1目录，运行命令： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-8-141 cm5.11.1]$ sudo createrepo  .</span><br></pre></td></tr></table></figure> ![此处输入图片的描述][5] 3.验证是否能通过浏览器访问![此处输入图片的描述][6]4.配置/etc/yum.repos.d/cloudera-manager.repo文件，内容如下<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name = Cloudera Manager, Version 5.11.1</span><br><span class="line">baseurl =  http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5.11.1/</span><br><span class="line">gpgcheck = 0</span><br></pre></td></tr></table></figure>5.测试yum源是否正常![此处输入图片的描述][7]**1.1.2备份Cloudera Manager数据库**1.停止Cloudera Management Service服务2.备份Cloudera Manager数据库，在命令行执行如下命令<figure class="highlight plain"><figcaption><span>cmdb_bak]$ mysqldump -u cm  -p --databases cm >cm.dump</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-8-141 cmdb_bak]$ mysqldump -u nas  -p --databases nas &gt;nas.dump</span><br><span class="line">[ec2-user@ip-172-31-8-141 cmdb_bak]$ mysqldump -u  nms -p --databases nms &gt;nms.dump</span><br><span class="line">[ec2-user@ip-172-31-8-141 cmdb_bak]$ mysqldump -u am  -p --databases am &gt;am.dump</span><br><span class="line">[ec2-user@ip-172-31-8-141 cmdb_bak]$ mysqldump -u rm  -p --databases rm &gt;rm.dump</span><br></pre></td></tr></table></figure>![此处输入图片的描述][8] 查找数据库相关的信息，可从如下文件中查找ClouderaManager Server的数据库信息，通过配置文件/etc/cloudera-scm-server/db.properties获取 ![此处输入图片的描述][9] 其它服务的数据库信息，可以通过CM管理界面获取 ![此处输入图片的描述][10]**1.2升级步骤**1.停止Cloudera Management Service服务2.停止Cloudera Manager Server和agent3.在Cloudera Manager上备份以下目录    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-8-141 cm_bak]$ sudo yum -y  upgrade cloudera-manager-server cloudera-manager-daemons  cloudera-manager-agent</span><br></pre></td></tr></table></figure> 检查是否安装成功  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-8-141 cm_bak]$ rpm -qa |grep  cloudera-</span><br></pre></td></tr></table></figure>注意文件目录权限与原数据目录权限一致。4.运行以下命令进行Cloudera Manager Server升级<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@ip-172-31-8-141 cm_bak]$ sudo yum -y  upgrade cloudera-manager-server cloudera-manager-daemons  cloudera-manager-agent</span><br></pre></td></tr></table></figure>检查是否安装成功<figure class="highlight plain"><figcaption><span>cm_bak]$ rpm -qa |grep  cloudera-```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">5.启动Cloudera Manager Server服务</span><br></pre></td></tr></table></figure>[ec2-user@ip-172-31-8-141 cloudera-scm-agent]$ sudo  service cloudera-scm-server start<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">    6.登录Cloudera Manager管理控制台，显示升级向导</span><br><span class="line">    </span><br><span class="line">    ![此处输入图片的描述][11]</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    7.选择升级Cloudera Manager Agent软件包，继续</span><br><span class="line">    ![此处输入图片的描述][12]</span><br><span class="line">    </span><br><span class="line">    8.选择“自定义存储库”，配置1.2章节的地址，点击“继续”</span><br><span class="line">    ![此处输入图片的描述][13]</span><br><span class="line">    </span><br><span class="line">    9.选择JDK选择，点击“继续”</span><br><span class="line">    ![此处输入图片的描述][14]</span><br><span class="line">    </span><br><span class="line">    10.根据要求输入SSH登录凭证，点击“继续”</span><br><span class="line">    ![此处输入图片的描述][15]</span><br><span class="line">    </span><br><span class="line">    11.等待安装完成，点击“继续”</span><br><span class="line">    ![此处输入图片的描述][16]</span><br><span class="line">    </span><br><span class="line">    12.检查完成，点击“完成”</span><br><span class="line">    ![此处输入图片的描述][17]</span><br><span class="line">    </span><br><span class="line">    13.进入审核更改向导界面，点击“继续”</span><br><span class="line">    ![此处输入图片的描述][18]</span><br><span class="line">    </span><br><span class="line">    14.选择重启Cloudera Management Service，点击“继续”</span><br><span class="line">    ![此处输入图片的描述][19]</span><br><span class="line">    </span><br><span class="line">    15.服务重启成功，点击“完成”</span><br><span class="line">    ![此处输入图片的描述][20]</span><br><span class="line">    Cloudera Manager在升级后报告过时的配置，请重新启动集群服务并重新部署客户端配置</span><br><span class="line">    ![此处输入图片的描述][21]</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    ## 3.Cloudera Manager升级验证 ##</span><br><span class="line">    1.查看Cloudera Manager版本</span><br><span class="line">    ![此处输入图片的描述][22]</span><br><span class="line">    版本显示为升级后版本</span><br><span class="line">    </span><br><span class="line">    2.验证Agent是否向Cloudera Manager发送心跳</span><br><span class="line">    ![此处输入图片的描述][23]</span><br><span class="line">    默认情况下，该心跳为15s一次；</span><br><span class="line">    </span><br><span class="line">    3.检查所有主机</span><br><span class="line">    ![此处输入图片的描述][24]</span><br><span class="line">    </span><br><span class="line">    4.集群历史监控数据</span><br><span class="line">    ![此处输入图片的描述][25]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 2. CDH升级</span><br><span class="line"> **2.1升级前准备</span><br><span class="line">    2.1.1准备CDH的parcels包**</span><br><span class="line">1.选择cdh5.11.1版本下载对应的parcels</span><br></pre></td></tr></table></figure></code></pre><p>wget <a href="http://archive.cloudera.com/cdh5/parcels/5.11.1/CDH-5.11.1-1.cdh5.11.1.p0.4-el6.parcel" target="_blank" rel="noopener">http://archive.cloudera.com/cdh5/parcels/5.11.1/CDH-5.11.1-1.cdh5.11.1.p0.4-el6.parcel</a><br>wget <a href="http://archive.cloudera.com/cdh5/parcels/5.11.1/CDH-5.11.1-1.cdh5.11.1.p0.4-el6.parcel.sha1" target="_blank" rel="noopener">http://archive.cloudera.com/cdh5/parcels/5.11.1/CDH-5.11.1-1.cdh5.11.1.p0.4-el6.parcel.sha1</a><br>wget <a href="http://archive.cloudera.com/cdh5/parcels/5.11.1/manifest.json" target="_blank" rel="noopener">http://archive.cloudera.com/cdh5/parcels/5.11.1/manifest.json</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2.将下载下来的3个文件，放在/var/www/html/cdh5.11.1目录下</span><br><span class="line"></span><br><span class="line">3.测试通过http是否能正常访问</span><br><span class="line">![此处输入图片的描述][26]</span><br><span class="line"></span><br><span class="line">配置完成后，供后面升级CDH使用</span><br><span class="line"></span><br><span class="line">**2.2升级流程**</span><br><span class="line">1.停止集群服务</span><br><span class="line">2.备份NameNode上的HDFS Metastore</span><br><span class="line">![此处输入图片的描述][27]</span><br><span class="line">在NameNode节点上备份该目录到指定目录下</span><br></pre></td></tr></table></figure></p><p>[ec2-user@ip-172-31-8-141 dfs]$ cd /dfs/<br>[ec2-user@ip-172-31-8-141 dfs]$ sudo tar -czvf /home/ec2-user/upgrade/nn_bak/nn_backup.tar.gz  nn/<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3.备份数据库</span><br></pre></td></tr></table></figure></p><p>[ec2-user@ip-172-31-8-141 hadoopdb_bak]$ mysqldump  -u hue -p –database hue &gt;hue.dump<br>[ec2-user@ip-172-31-8-141 hadoopdb_bak]$ mysqldump  -u hive -p –database metastore &gt;metastore.dump<br>[ec2-user@ip-172-31-8-141 hadoopdb_bak]$ mysqldump  -u oozie -p –database oozie &gt;oozie.dump<br>[ec2-user@ip-172-31-8-141 hadoopdb_bak]$ mysqldump  -u sentry -p –database sentry &gt;sentry.dump<br>[ec2-user@ip-172-31-8-141 cmdb_bak]$ mysqldump -u cm  -p –databases cm &gt;cm.dump<br>[ec2-user@ip-172-31-8-141 cmdb_bak]$ mysqldump -u nas  -p –databases nas &gt;nas.dump<br>[ec2-user@ip-172-31-8-141 cmdb_bak]$ mysqldump -u  nms -p –databases nms &gt;nms.dump<br>[ec2-user@ip-172-31-8-141 cmdb_bak]$ mysqldump -u am  -p –databases am &gt;am.dump<br>[ec2-user@ip-172-31-8-141 cmdb_bak]$ mysqldump -u rm  -p –databases rm &gt;rm.dump<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4.向集群中添加新版的CDH存储库</span><br><span class="line">![此处输入图片的描述][28]</span><br><span class="line">![此处输入图片的描述][29]</span><br><span class="line">![此处输入图片的描述][30]</span><br><span class="line"></span><br><span class="line">5.运行升级向导</span><br><span class="line">![此处输入图片的描述][31]</span><br><span class="line">6.进入升级向导界面</span><br><span class="line">![此处输入图片的描述][32]</span><br><span class="line">7.确认CDH版本是否正确，点击“继续”</span><br><span class="line">8.选择“是”，点击“继续”</span><br><span class="line">![此处输入图片的描述][33]</span><br><span class="line">9.点击“继续”</span><br><span class="line">![此处输入图片的描述][34]</span><br><span class="line">10.等待安装完成后，点击“继续”</span><br><span class="line">![此处输入图片的描述][35]</span><br><span class="line">11.检查主机完成后，点击“继续”</span><br><span class="line">12.选择完整集群升级，点击“继续”</span><br><span class="line">13.等待升级集群命令完成，点击“继续”</span><br><span class="line">![此处输入图片的描述][36]</span><br><span class="line">14.集群升级成功</span><br><span class="line">![此处输入图片的描述][37]</span><br><span class="line">15.最终化元数据升级</span><br><span class="line">在最终化元数据之前，进行几天甚至几周的运行观察集群是否正常，在发现所有任务都没有任何异常情况后，再进行最终化元数据操作。一旦进行最终化元数据之后，就不能回滚到老的版本了，除非有数据备份。对NameNode的主备节点都执行最终化元数据升级操作：</span><br><span class="line">![此处输入图片的描述][38]</span><br><span class="line">![此处输入图片的描述][39]</span><br><span class="line"></span><br><span class="line">**2.3功能验证**</span><br><span class="line">1.运行一个MapReduce作业</span><br><span class="line">    登录集群服务器，操作如下指令</span><br></pre></td></tr></table></figure></p><pre><code>sudo -u hdfs hadoop jar  /opt/cloudera/parcels/CDH/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar  pi 10 100```![此处输入图片的描述][40]</code></pre><p>2.用Hue测试<br>    Hue正常登录，通过Hue操作HBase，向HBase中新建一个test表<br>    <img src="https://mmbiz.qpic.cn/mmbiz_png/THumz4762QDbM3QAly6pQeCToAHTmYVOiardBEzDV7vZoia7R8ZtHq2f3k4U52ExD48rDOEdrZXiaPlxz5Zxuqd4w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="此处输入图片的描述"><br>    向test表中添加一条数据<br>    <img src="https://mmbiz.qpic.cn/mmbiz_png/THumz4762QDbM3QAly6pQeCToAHTmYVO8bpWQ4yTqGVgFOWbvQNKbv7XUN8icOeBXkicJkyO8riaIPmhSoicv5TTsA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="此处输入图片的描述"><br>    数据添加成功<br>    <img src="https://mmbiz.qpic.cn/mmbiz_png/THumz4762QDbM3QAly6pQeCToAHTmYVOicHhaib7iaAaGPUziazPwtXzBFbCUug2ZKmBGbiaGEn5AsWD91VIs7ibBlicQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="此处输入图片的描述"><br>    通过hbase-shell查看该表是否存在</p><p>3.测试hive</p><p>4.。。。。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;如何升级Cloudera-Manager和CDH&quot;&gt;&lt;a href=&quot;#如何升级Cloudera-Manager和CDH&quot; class=&quot;headerlink&quot; title=&quot;如何升级Cloudera Manager和CDH&quot;&gt;&lt;/a&gt;如何升级Cloudera M
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://san-y.github.io/hello-world/"/>
    <id>http://san-y.github.io/hello-world/</id>
    <published>2018-09-19T08:44:05.037Z</published>
    <updated>2018-09-19T08:44:05.038Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
  </entry>
  
</feed>
